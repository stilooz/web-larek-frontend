# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами
- src/components/base/OrderPresenter.ts — презентер для оформления заказа

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура проекта

- **Model** — управление данными и бизнес-логика (ApiModel, BasketModel).
- **View** — пользовательский интерфейс (Card, FormOrder, FormContacts, Basket, Modal, Success, StoreView).
- **Presenter** — посредник между Model и View, реализован через EventEmitter (CatalogPresenter, BasketPresenter, OrderPresenter).


## Описание основных компонентов

### Модели (model)
- **ApiModel**  
  Запросы к серверу (получение списка товаров, отправка заказа и т.д.).
- **BasketModel**  
  Хранение состояния корзины. Методы для добавления, удаления, очистки товаров, выдачи текущего состояния корзины.  
  Использует событийную модель для оповещения презентеров/вью о изменениях.
- **FormModel**  
  Валидация контактов (email, телефон), валидация адреса и способа оплаты. Отправка заказа на сервер, работа с ошибками валидации.

### Презентеры (presenters)
- **CatalogPresenter**  
  Запрашивает список товаров через модель, инициирует рендер карточек, обрабатывает клики по карточкам (открытие модалок).
- **BasketPresenter**  
  Слушает события от BasketModel и обновляет корзину на экране, обрабатывает добавление/удаление/очистку.
- **OrderPresenter**  
  Управляет этапами оформления заказа: выбор способа оплаты и адреса, ввод контактов, подтверждение заказа.

### Вью (view)
- **Card, CardPreview**  
  Компоненты для показа товаров в каталоге и в отдельных модальных окнах.
- **Basket**  
  Компонент для показа корзины и её содержимого.
- **FormOrder, FormContacts**  
  Формы пошагового оформления заказа: сначала адрес и оплата, затем контакты.
- **Success**  
  Модальное окно с подтверждением успешного заказа.
- **Modal**  
  Базовый компонент для любых модальных окон.
- **StoreView**  
  Основной контейнер: собирает остальные вью-компоненты для показа на главной странице.

### Типы (types/index.ts)
- Описаны интерфейсы, типы товаров, заказов, контактов и других данных (всё, что используется для строгой типизации и удобной работы между слоями).

## Описание основных классов и методов

### Модели (`src/components/model/`)

**ApiModel**
- `getListProductCard()` — получает список товаров с сервера.
- `getProductById(id)` — получает подробную информацию о товаре по id.
- `submitOrder(data)` — отправляет заказ на сервер.

**BasketModel**
- `addItem(product)` — добавить товар в корзину (если такого ещё нет).
- `removeItem(productId)` — удалить товар из корзины по id.
- `getItems()` — получить текущий список товаров в корзине.
- `clear()` — полностью очистить корзину.
- Использует события: оповещает подписчиков о каждом изменении содержимого корзины.

**FormModel**
- `static validateContacts(data)` — проверить email и телефон (возвращает ошибки, если поля не заполнены).
- `static validateAddress(data)` — проверить адрес доставки.
- `static validatePayment(data)` — проверить выбор способа оплаты.
- `submitOrder(orderData)` — отправить заказ (использует `ApiModel`).
- Реализует валидацию каждого шага — при ошибке возвращает текст ошибки.

### Презентеры (`src/components/presenters/`)

**CatalogPresenter**
- `init()` — получить товары через ApiModel и отрисовать каталог.
- `renderCatalog(products)` — показать карточки товаров на странице.
- Обрабатывает клики по карточкам для открытия детальной информации.

**BasketPresenter**
- `init()` — подключить обработчики, начать слушать изменения в BasketModel.
- `updateCounter()` — обновить число товаров на иконке корзины.
- `updateCardPreviewButton()` — показать или скрыть кнопку предпросмотра товара (если есть).
- Реализует логику отображения и обновления корзины при изменениях.

**OrderPresenter**
- `startOrder()` — начать процесс оформления заказа.
- `handlePaymentStep(data)` — обработать ввод адреса и способа оплаты.
- `handleContactsStep(data)` — обработать ввод почты и телефона.
- `submitOrder()` — отправить заказ (через FormModel).
- `showSuccess()` — показать окно успешной оплаты.
- Контролирует переходы между шагами, валидацию и обработку ошибок.


### View (`src/components/view/`)

**Card**
- `constructor(product, events)` — создать карточку товара.
- `render()` — отрисовать карточку на странице.
- Обработка кликов "Купить" и открытия деталей.

**CardPreview**
- `constructor(product, events)` — создать модалку предпросмотра.
- `render()` — показать модалку с подробной информацией о товаре.

**Basket**
- `render(items)` — показать содержимое корзины.
- `show()` / `hide()` — открыть/закрыть корзину.
- Реагирует на изменение модели.

**FormOrder**
- `render()` — показать форму адреса и оплаты.
- `getData()` — получить введённые данные (адрес, способ оплаты).
- `showError(field, message)` — отобразить ошибку под полем.

**FormContacts**
- `render()` — показать форму почты и телефона.
- `getData()` — получить введённые данные (email, телефон).
- `showError(field, message)` — отобразить ошибку.

**Success**
- `show()` — открыть окно успешной оплаты.
- `hide()` — закрыть окно.

**Modal**
- `open(content)` — открыть модалку с переданным контентом.
- `close()` — закрыть модалку.
- Реализует базовое поведение для всех модальных окон: закрытие по клику вне окна, по крестику.

**StoreView**
- `render()` — собрать и отрисовать основные части магазина (каталог, корзину и т.д.).

### Типы (`src/types/index.ts`)
- `Product` — тип товара (id, название, цена, картинка и т.д.).
- `Order` — структура заказа (товары, способ оплаты, контакты и пр.).
- `Contact` — тип для данных пользователя (email, телефон и т.д.).


## Сценарий работы приложения

1. **Загрузка данных** — список товаров подгружается с сервера с помощью модели `ApiModel`.
2. **Сохранение товаров** — полученные товары сохраняются во внутреннем состоянии приложения.
3. **Отрисовка каталога** — товары отображаются с помощью компонентов `Card` (в каталоге) и `CardPreview` (в модалке).
4. **Просмотр товара** — при клике на карточку открывается модальное окно (`Modal`) с подробной информацией о товаре (`CardPreview`).
5. **Добавление в корзину** — по кнопке "Купить" информация о товаре передаётся в модель `BasketModel`, корзина обновляется.
6. **Работа с корзиной** — корзина (`Basket`) отображает все выбранные товары, позволяет удалять и очищать их.
7. **Оформление заказа (шаг 1)** — при клике "Оформить" открывается форма (`FormOrder`) для выбора способа оплаты и ввода адреса доставки.
8. **Переход ко второму шагу** — после успешного заполнения адреса и выбора оплаты данные передаются, открывается форма контактов (`FormContacts`).
9. **Ввод контактов (шаг 2)** — пользователь вводит email и телефон, форма валидируется, данные отправляются для оформления заказа.
10. **Отправка заказа** — заказ отправляется на сервер (`ApiModel`) вместе с данными о товарах, доставке и контактах.
11. **Завершение оформления** — после успешной отправки корзина очищается, появляется окно подтверждения (`Success`).

**Все действия пользователя сопровождаются валидацией на каждом шаге, а модальные окна можно закрыть по клику вне окна или на крестик.**